<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>BearWatch</title>
    <link href="{{ url_for('static', filename='stock.css') }}" rel="stylesheet" type="text/css" />

    <style>
        #news-ticker {
            overflow: hidden;
            white-space: nowrap;
            background-color: #f2f2f2;
            padding: 10px;
            border-bottom: 2px solid #ccc;
            font-weight: bold;
        }

        #ticker-text {
            display: inline-block;
            padding-left: 100%;
            animation: scroll-left 25s linear infinite;
        }

        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        #ticker-text a {
            margin-right: 40px;
            text-decoration: none;
            color: #333;
        }
    </style>
</head>

<body>

    <div id="logo">
        <a href="/">
            <img src="{{ url_for('static', filename='BearWatchLogo.png') }}" alt="BearWatch Logo">
        </a>
    </div>

    <div id="search">
        <form id="search-form" action="{{ url_for('stock') }}" method="GET">
            <div id="search-wrapper">
                <input id="stock-input" name="stock" type="text" placeholder="Enter stock symbol" value="{{ stock_symbol }}" required autocomplete="off">
                <div id="suggestions" class="suggestions-box"></div>
                <button id="submit-button" type="submit">Submit</button>
            </div>
        </form>
    </div>

    <div id="news-ticker">
        <a href="news.html">
            <div id="ticker-text">
                {% for article in ticker_news %}
                    <a href="{{ article.link }}" target="_blank">{{ article.title }}</a>
                {% endfor %}
            </div>
        </a>
    </div>

    <div id="stock-header">
        <h1>{{ stock_symbol }} Overview</h1>
    </div>

    <div id="graph">
        <iframe id="stock-graph" src="/dashboard?stock={{ stock_symbol }}" width="100%" height="600px" style="border:none;"></iframe>
    </div>

    <div id="time-buttons">
        <button>1D</button>
        <button>1W</button>
        <button>1M</button>
        <button>3M</button>
        <button>YTD</button>
        <button>1Y</button>
        <button>ALL</button>
    </div>

    <div id="stock-headlines">
        <h2><a href="news.html">Stock Headlines</a></h2>
        <ul>
            {% for headline in stock_news %}
                <li><a href="{{ headline.link }}" target="_blank">{{ headline.title }}</a></li>
            {% endfor %}
        </ul>
    </div>

    <div id="trending">
        <h2>Trending Stocks</h2>
    </div>

    <div id="recommended-stocks">
        <h2>Recommended Stocks</h2>
        <ul id="recommended-stocks-list"></ul>
    </div>

    <div id="information">
        <h2>Stock Overview</h2>
    </div>

    <div id="stats">
        <h2>Stock Information</h2>
    </div>

    <script>
        const stockInput = document.getElementById('stock-input');
        const suggestionsBox = document.getElementById('suggestions');
        const toggleButton = document.getElementById('dark-mode-button');
        const colorblindBtn = document.getElementById('colorblind-button');

        if (toggleButton) {
            toggleButton.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('darkMode', document.body.classList.contains('dark-mode').toString());
            });
        }

        if (colorblindBtn) {
            colorblindBtn.addEventListener('click', () => {
                const iframe = document.getElementById('stock-graph');
                const src = new URL(iframe.src);
                const currentMode = src.searchParams.get('colorblind') === 'true';
                src.searchParams.set('colorblind', (!currentMode).toString());
                iframe.src = src.toString();
                localStorage.setItem('colorblindMode', (!currentMode).toString());
            });
        }

        window.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
            }

            const savedColorblind = localStorage.getItem('colorblindMode');
            if (savedColorblind === 'true' || savedColorblind === 'false') {
                const iframe = document.getElementById('stock-graph');
                const src = new URL(iframe.src);
                src.searchParams.set('colorblind', savedColorblind);
                iframe.src = src.toString();
            }
        });

        stockInput.addEventListener('input', async function () {
            const query = stockInput.value.trim();
            if (query.length === 0) {
                suggestionsBox.style.display = 'none';
                suggestionsBox.innerHTML = "";
                return;
            }

            try {
                const response = await fetch(`/autocomplete_stock?query=${query}`);
                const suggestions = await response.json();
                suggestionsBox.innerHTML = "";

                if (suggestions.length === 0) {
                    suggestionsBox.style.display = 'none';
                    return;
                }

                suggestions.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'suggestion';
                    div.textContent = `${item.name} (${item.symbol})`;
                    div.addEventListener('click', () => {
                        stockInput.value = item.symbol;
                        suggestionsBox.style.display = 'none';
                        suggestionsBox.innerHTML = "";
                        document.getElementById('search-form').submit();
                    });
                    suggestionsBox.appendChild(div);
                });

                suggestionsBox.style.display = 'block';
            } catch (error) {
                console.error('Error fetching suggestions:', error);
            }
        });
    </script>

</body>
</html>
